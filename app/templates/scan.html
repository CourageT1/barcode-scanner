{% extends 'layout.html' %}

{% block content %}
    <section>
        <h2>Scan Product</h2>
        <div>
            <button id="scan-btn" onclick="scanBarcode()">Scan Barcode</button>
            <p>OR</p>
            <label for="manual-barcode">Enter Barcode:</label>
            <input type="text" id="manual-barcode">
            <button id="submit-manual" onclick="submitManual()">Submit</button>
        </div>
        <div id="scan-result"></div>
    </section>

    <script>
        function scanBarcode() {
            // Simulate scanning - you'd replace this with actual barcode scanning logic
            var barcode = '1234567890123';

            // Call the backend to get product information
            fetch('/scan', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ barcode: barcode }),
            })
            .then(response => response.json())
            .then(data => {
                displayScanResult(data);
            })
            .catch(error => console.error('Error:', error));
        }

        function submitManual() {
            var manualBarcode = document.getElementById('manual-barcode').value;

            // Call the backend to get product information
            fetch('/scan', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ barcode: manualBarcode }),
            })
            .then(response => response.json())
            .then(data => {
                displayScanResult(data);
            })
            .catch(error => console.error('Error:', error));
        }

        function displayScanResult(data) {
            var resultDiv = document.getElementById('scan-result');
            resultDiv.innerHTML = '';

            if (data.found) {
                var productInfo = data.product_info;
                resultDiv.innerHTML = `
                    <p>Product Name: ${productInfo.name}</p>
                    <p>Price: ${productInfo.price}</p>
                    <p>Expiry Date: ${productInfo.expiry_date}</p>
                    <p>Promotion: ${productInfo.promotion}</p>
                    <img src="${productInfo.image_url}" alt="${productInfo.name}" style="max-width: 200px;">
                `;
            } else {
                resultDiv.innerHTML = '<p>Product not found.</p>';
            }
        }
    </script>
{% endblock %}
